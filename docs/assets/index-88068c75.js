var at=Object.defineProperty;var it=(t,e,r)=>e in t?at(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var l=(t,e,r)=>(it(t,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();let s={multiply:function(t,e){var r=e[0],o=e[0*4+1],a=e[0*4+2],i=e[0*4+3],c=e[1*4+0],u=e[1*4+1],m=e[1*4+2],d=e[1*4+3],h=e[2*4+0],p=e[2*4+1],y=e[2*4+2],g=e[2*4+3],L=e[3*4+0],w=e[3*4+1],A=e[3*4+2],x=e[3*4+3],P=t[0*4+0],k=t[0*4+1],S=t[0*4+2],R=t[0*4+3],b=t[1*4+0],_=t[1*4+1],T=t[1*4+2],M=t[1*4+3],E=t[2*4+0],D=t[2*4+1],F=t[2*4+2],z=t[2*4+3],B=t[3*4+0],I=t[3*4+1],U=t[3*4+2],V=t[3*4+3];return[r*P+o*b+a*E+i*B,r*k+o*_+a*D+i*I,r*S+o*T+a*F+i*U,r*R+o*M+a*z+i*V,c*P+u*b+m*E+d*B,c*k+u*_+m*D+d*I,c*S+u*T+m*F+d*U,c*R+u*M+m*z+d*V,h*P+p*b+y*E+g*B,h*k+p*_+y*D+g*I,h*S+p*T+y*F+g*U,h*R+p*M+y*z+g*V,L*P+w*b+A*E+x*B,L*k+w*_+A*D+x*I,L*S+w*T+A*F+x*U,L*R+w*M+A*z+x*V]},inverse:function(t){var e=t[0],r=t[0*4+1],o=t[0*4+2],a=t[0*4+3],i=t[1*4+0],c=t[1*4+1],u=t[1*4+2],m=t[1*4+3],d=t[2*4+0],h=t[2*4+1],p=t[2*4+2],y=t[2*4+3],g=t[3*4+0],L=t[3*4+1],w=t[3*4+2],A=t[3*4+3],x=p*A,P=w*y,k=u*A,S=w*m,R=u*y,b=p*m,_=o*A,T=w*a,M=o*y,E=p*a,D=o*m,F=u*a,z=d*L,B=g*h,I=i*L,U=g*c,V=i*h,N=d*c,O=e*L,C=g*r,j=e*h,Y=d*r,H=e*c,W=i*r,J=x*c+S*h+R*L-(P*c+k*h+b*L),Q=P*r+_*h+E*L-(x*r+T*h+M*L),Z=k*r+T*c+D*L-(S*r+_*c+F*L),tt=b*r+M*c+F*h-(R*r+E*c+D*h),f=1/(e*J+i*Q+d*Z+g*tt);return[f*J,f*Q,f*Z,f*tt,f*(P*i+k*d+b*g-(x*i+S*d+R*g)),f*(x*e+T*d+M*g-(P*e+_*d+E*g)),f*(S*e+_*i+F*g-(k*e+T*i+D*g)),f*(R*e+E*i+D*d-(b*e+M*i+F*d)),f*(z*m+U*y+V*A-(B*m+I*y+N*A)),f*(B*a+O*y+Y*A-(z*a+C*y+j*A)),f*(I*a+C*m+H*A-(U*a+O*m+W*A)),f*(N*a+j*m+W*y-(V*a+Y*m+H*y)),f*(I*p+N*w+B*u-(V*w+z*u+U*p)),f*(j*w+z*o+C*p-(O*p+Y*w+B*o)),f*(O*u+W*w+U*o-(H*w+I*o+C*u)),f*(H*p+V*o+Y*u-(j*u+W*p+N*o))]},radToDeg:function(t){return t*180/Math.PI},degToRad:function(t){return t*Math.PI/180},normalize:function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return e>1e-5?[t[0]/e,t[1]/e,t[2]/e]:[0,0,0]},cross:function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},subtractVectors:function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},lookAt:function(t,e,r){var o=s.normalize(s.subtractVectors(t,e)),a=s.normalize(s.cross(r,o)),i=s.normalize(s.cross(o,a));return[a[0],a[1],a[2],0,i[0],i[1],i[2],0,o[0],o[1],o[2],0,t[0],t[1],t[2],1]},transformVector:function(t,e){for(var r=[],o=0;o<4;++o){r[o]=0;for(var a=0;a<4;++a)r[o]+=e[a]*t[a*4+o]}return r},perspective:function(t,e,r,o){var a=Math.tan(Math.PI*.5-.5*t),i=1/(r-o);return[a/e,0,0,0,0,a,0,0,0,0,(r+o)*i,-1,0,0,r*o*i*2,0]},orthographic:function(t,e,r,o,a,i){return[2/(e-t),0,0,0,0,2/(o-r),0,0,0,0,2/(a-i),0,(t+e)/(t-e),(r+o)/(r-o),(a+i)/(a-i),1]},projection:function(t,e,r){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/r,0,-1,1,0,1]},translation:function(t,e,r){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1]},xRotation:function(t){let e=Math.cos(t),r=Math.sin(t);return[1,0,0,0,0,e,r,0,0,-r,e,0,0,0,0,1]},yRotation:function(t){let e=Math.cos(t),r=Math.sin(t);return[e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1]},zRotation:function(t){let e=Math.cos(t),r=Math.sin(t);return[e,r,0,0,-r,e,0,0,0,0,1,0,0,0,0,1]},scaling:function(t,e,r){return[t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1]},translate:function(t,e,r,o){return s.multiply(t,s.translation(e,r,o))},xRotate:function(t,e){return s.multiply(t,s.xRotation(e))},yRotate:function(t,e){return s.multiply(t,s.yRotation(e))},zRotate:function(t,e){return s.multiply(t,s.zRotation(e))},scale:function(t,e,r,o){return s.multiply(t,s.scaling(e,r,o))}},nt=`#version 300 es

  //in vec4 a_color;
  in vec4 a_position;
  in vec3 a_normal;
  uniform mat4 u_worldViewProjection;
  uniform mat4 u_world;

  // a varying the color to the fragment shader
  //out vec4 v_color;
  out vec3 v_normal;
   
  void main() {
    // Pass the color to the fragment shader.
    //v_color = a_color;
    
    gl_Position = u_worldViewProjection * a_position;

    // orient the normals and pass to the fragment shader
     v_normal = mat3(u_world) * a_normal;
  }
`,st=`#version 300 es
 
// fragment shaders don't have a default precision so we need
// to pick one. highp is a good default. It means "high precision"
precision highp float;

// the varied color passed from the vertex shader
//in vec4 v_color;

// Passed in and varied from the vertex shader.
in vec3 v_normal;
 
uniform vec3 u_reverseLightDirection;
uniform vec4 u_color;
 
// we need to declare an output for the fragment shader
out vec4 outColor;
 
void main() {
  // outColor = v_color;

  // because v_normal is a varying it's interpolated
  // so it will not be a unit vector. Normalizing it
  // will make it a unit vector again
  vec3 normal = normalize(v_normal);
 
  // compute the light by taking the dot product
  // of the normal to the light's reverse direction
  float light = dot(normal, u_reverseLightDirection);
  
  outColor = u_color;
  outColor.rgb *= light;
  if(outColor.r < 0.1) outColor.rgb = vec3(u_color) / 4.0;
}
`;function et(t,e,r){var o=t.createShader(e);t.shaderSource(o,r),t.compileShader(o);var a=t.getShaderParameter(o,t.COMPILE_STATUS);if(a)return o;console.log(t.getShaderInfoLog(o)),t.deleteShader(o)}function lt(t,e,r){var o=t.createProgram();t.attachShader(o,e),t.attachShader(o,r),t.linkProgram(o);var a=t.getProgramParameter(o,t.LINK_STATUS);if(a)return o}const n=class{constructor(){l(this,"positionMatrix");n.isInitCalled||n.init(),this.positionMatrix=s.yRotation(0)}static init(){n.isInitCalled=!0,n.generatePositions(),n.generateNormals(),n.drawCode="cube",n.vertexShader=et(gl,gl.VERTEX_SHADER,nt),n.fragmentShader=et(gl,gl.FRAGMENT_SHADER,st),n.program=lt(gl,n.vertexShader,n.fragmentShader),n.worldViewProjectionLocation=gl.getUniformLocation(n.program,"u_worldViewProjection"),n.worldLocation=gl.getUniformLocation(n.program,"u_world"),n.positionAttributeLocation=gl.getAttribLocation(n.program,"a_position"),n.colorUniformLocation=gl.getUniformLocation(n.program,"u_color"),n.reverseLightDirectionLocation=gl.getUniformLocation(n.program,"u_reverseLightDirection"),n.normalAttributeLocation=gl.getAttribLocation(n.program,"a_normal"),n.vao=gl.createVertexArray(),gl.bindVertexArray(n.vao),n.normalBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,n.normalBuffer),gl.bufferData(gl.ARRAY_BUFFER,n.normals,gl.STATIC_DRAW),gl.enableVertexAttribArray(n.normalAttributeLocation),gl.vertexAttribPointer(n.normalAttributeLocation,3,gl.FLOAT,!1,0,0),n.positionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,n.positionBuffer),gl.bufferData(gl.ARRAY_BUFFER,n.positions,gl.STATIC_DRAW),gl.enableVertexAttribArray(n.positionAttributeLocation);let e=3,r=gl.FLOAT,o=!1,a=0,i=0;gl.vertexAttribPointer(n.positionAttributeLocation,e,r,o,a,i)}draw(e,r){e!=n.drawCode&&(gl.useProgram(n.program),gl.uniform3fv(n.reverseLightDirectionLocation,s.normalize([.5,.7,1])),gl.uniformMatrix4fv(n.worldLocation,!1,s.yRotation(0)),gl.uniform4fv(n.colorUniformLocation,[.2,1,.2,1])),gl.uniformMatrix4fv(n.worldViewProjectionLocation,!1,r);let o=gl.TRIANGLES,a=0,i=36;gl.drawArrays(o,a,i)}translate(e,r,o){this.positionMatrix=s.translate(this.positionMatrix,e,r,o)}scale(e,r,o){this.positionMatrix=s.scale(this.positionMatrix,e,r,o)}static generatePositions(){n.positions=new Float32Array([1,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,1,0,0,0,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,0,1,1,1,1,1,1,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,0,0,1,0,0,1,1,1,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,1])}static generateColors(){n.colors=new Uint8Array([255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,0,0,255,0,0,255,255,255,0,0,0,255,0,0,255,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255])}static generateNormals(){n.normals=new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0])}};let v=n;l(v,"isInitCalled"),l(v,"drawCode"),l(v,"positions"),l(v,"normals"),l(v,"vertexShader"),l(v,"fragmentShader"),l(v,"program"),l(v,"positionAttributeLocation"),l(v,"colorUniformLocation"),l(v,"reverseLightDirectionLocation"),l(v,"normalAttributeLocation"),l(v,"worldLocation"),l(v,"worldViewProjectionLocation"),l(v,"vao"),l(v,"positionBuffer"),l(v,"normalBuffer");class ct{constructor(){l(this,"matrix");l(this,"Keyboard");l(this,"canvas");l(this,"isPointerLocked");this.matrix=s.lookAt([80,40,110],[0,0,0],[0,1,0])}translate(e,r,o){this.matrix=s.translate(this.matrix,e,r,o)}init(){this.canvas=document.querySelector("#c"),this.canvas.requestPointerLock=this.canvas.requestPointerLock||this.canvas.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,document.addEventListener("pointerlockchange",()=>this.isPointerLocked=!this.isPointerLocked,!1),this.canvas.onclick=()=>{this.isPointerLocked||this.canvas.requestPointerLock()},this.canvas.addEventListener("mousemove",e=>{log4(`mouse: ${e.clientX}:${e.clientY} mousemovementX: ${e.movementX} mousemovementY: ${e.movementY} canvas dim: ${this.canvas.width}:${this.canvas.height}`),this.isPointerLocked&&(this.matrix=s.yRotate(this.matrix,-.001*e.movementX),this.matrix=s.xRotate(this.matrix,-.001*e.movementY))},!1),this.Keyboard={keys:{},keyPress:function(e){this.keys[e.key]>0||(this.keys[e.key]=e.timeStamp||new Date().getTime(),log4(JSON.stringify(this.keys)))},keyRelease:function(e){this.keys[e.key]=0,log4(JSON.stringify(this.keys))}},window.addEventListener("keydown",this.Keyboard.keyPress.bind(this.Keyboard)),window.addEventListener("keyup",this.Keyboard.keyRelease.bind(this.Keyboard))}update(){this.Keyboard.keys.w>0&&this.translate(0,0,-1.1),this.Keyboard.keys.s>0&&this.translate(0,0,1.1),this.Keyboard.keys.a>0&&this.translate(-1.1,0,0),this.Keyboard.keys.d>0&&this.translate(1.1,0,0),this.Keyboard.keys.escape>0&&document.exitPointerLock()}}let ut=0,X,$=[],rt,mt=document.querySelector("#fps"),K=100,q,G=0;function vt(){var t=document.querySelector("#c");if(globalThis.gl=t.getContext("webgl2"),!gl){alert("error: no webgl capability");return}let e=[],r=0;for(let o=0;o<q.data.length;o+=4)e[r]=(255-(.2126*q.data[o+0]+.7152*q.data[o+1]+.0722*q.data[o+2]))/10,r++;for(let o=0;o<K;o++)for(let a=0;a<K;a++){let i=new v;i.scale(1,e[K*a+o],1),i.translate(o*1,0,a*1),$.push(i)}X=new ct,X.init(),ot()}function ot(){let t=Date.now();gl.enable(gl.CULL_FACE),gl.enable(gl.DEPTH_TEST),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),dt(gl.canvas),gl.viewport(0,0,gl.canvas.width,gl.canvas.height);var e=gl.canvas.clientWidth/gl.canvas.clientHeight,r=.1,o=500,a=s.perspective(s.degToRad(75),e,r,o),i=s.inverse(X.matrix),c=s.multiply(a,i);for(let u=0;u<K;u++)for(let m=0;m<K;m++){let d=s.multiply(c,$[K*m+u].positionMatrix);$[K*m+u].draw(rt,d),rt=$[K*m+u].constructor.drawCode}X.update(),G>1e3?(mt.textContent=1e3/(Date.now()-t),G=0):G+=Date.now()-t,window.requestAnimationFrame(ot)}function dt(t){const e=t.clientWidth,r=t.clientHeight,o=t.width!==e||t.height!==r;return o&&(t.width=e,t.height=r),o}function ft(){[1,2,3,4,5].forEach(e=>{globalThis["log"+e]=function(r){ut>=e&&console.log(r)}})}function gt(){let t=document.querySelector("#imgc");log5(t.width+" "+t.height);let e=t.getContext("2d"),r=document.querySelector("#image");e.drawImage(r,0,0,100,100),q=e.getImageData(0,0,t.width,t.height),log5(q)}window.addEventListener("load",t=>{ft(),gt(),vt()});
