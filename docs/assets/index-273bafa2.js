var at=Object.defineProperty;var nt=(t,e,r)=>e in t?at(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var l=(t,e,r)=>(nt(t,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();let s={multiply:function(t,e){var r=e[0],o=e[0*4+1],i=e[0*4+2],n=e[0*4+3],c=e[1*4+0],u=e[1*4+1],m=e[1*4+2],d=e[1*4+3],h=e[2*4+0],p=e[2*4+1],y=e[2*4+2],g=e[2*4+3],L=e[3*4+0],w=e[3*4+1],x=e[3*4+2],A=e[3*4+3],P=t[0*4+0],S=t[0*4+1],k=t[0*4+2],R=t[0*4+3],b=t[1*4+0],_=t[1*4+1],T=t[1*4+2],E=t[1*4+3],M=t[2*4+0],F=t[2*4+1],D=t[2*4+2],z=t[2*4+3],I=t[3*4+0],B=t[3*4+1],U=t[3*4+2],q=t[3*4+3];return[r*P+o*b+i*M+n*I,r*S+o*_+i*F+n*B,r*k+o*T+i*D+n*U,r*R+o*E+i*z+n*q,c*P+u*b+m*M+d*I,c*S+u*_+m*F+d*B,c*k+u*T+m*D+d*U,c*R+u*E+m*z+d*q,h*P+p*b+y*M+g*I,h*S+p*_+y*F+g*B,h*k+p*T+y*D+g*U,h*R+p*E+y*z+g*q,L*P+w*b+x*M+A*I,L*S+w*_+x*F+A*B,L*k+w*T+x*D+A*U,L*R+w*E+x*z+A*q]},inverse:function(t){var e=t[0],r=t[0*4+1],o=t[0*4+2],i=t[0*4+3],n=t[1*4+0],c=t[1*4+1],u=t[1*4+2],m=t[1*4+3],d=t[2*4+0],h=t[2*4+1],p=t[2*4+2],y=t[2*4+3],g=t[3*4+0],L=t[3*4+1],w=t[3*4+2],x=t[3*4+3],A=p*x,P=w*y,S=u*x,k=w*m,R=u*y,b=p*m,_=o*x,T=w*i,E=o*y,M=p*i,F=o*m,D=u*i,z=d*L,I=g*h,B=n*L,U=g*c,q=n*h,O=d*c,C=e*L,j=g*r,Y=e*h,H=d*r,$=e*c,W=n*r,Q=A*c+k*h+R*L-(P*c+S*h+b*L),Z=P*r+_*h+M*L-(A*r+T*h+E*L),tt=S*r+T*c+F*L-(k*r+_*c+D*L),et=b*r+E*c+D*h-(R*r+M*c+F*h),f=1/(e*Q+n*Z+d*tt+g*et);return[f*Q,f*Z,f*tt,f*et,f*(P*n+S*d+b*g-(A*n+k*d+R*g)),f*(A*e+T*d+E*g-(P*e+_*d+M*g)),f*(k*e+_*n+D*g-(S*e+T*n+F*g)),f*(R*e+M*n+F*d-(b*e+E*n+D*d)),f*(z*m+U*y+q*x-(I*m+B*y+O*x)),f*(I*i+C*y+H*x-(z*i+j*y+Y*x)),f*(B*i+j*m+$*x-(U*i+C*m+W*x)),f*(O*i+Y*m+W*y-(q*i+H*m+$*y)),f*(B*p+O*w+I*u-(q*w+z*u+U*p)),f*(Y*w+z*o+j*p-(C*p+H*w+I*o)),f*(C*u+W*w+U*o-($*w+B*o+j*u)),f*($*p+q*o+H*u-(Y*u+W*p+O*o))]},radToDeg:function(t){return t*180/Math.PI},degToRad:function(t){return t*Math.PI/180},normalize:function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return e>1e-5?[t[0]/e,t[1]/e,t[2]/e]:[0,0,0]},cross:function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]},subtractVectors:function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},lookAt:function(t,e,r){var o=s.normalize(s.subtractVectors(t,e)),i=s.normalize(s.cross(r,o)),n=s.normalize(s.cross(o,i));return[i[0],i[1],i[2],0,n[0],n[1],n[2],0,o[0],o[1],o[2],0,t[0],t[1],t[2],1]},transformVector:function(t,e){for(var r=[],o=0;o<4;++o){r[o]=0;for(var i=0;i<4;++i)r[o]+=e[i]*t[i*4+o]}return r},perspective:function(t,e,r,o){var i=Math.tan(Math.PI*.5-.5*t),n=1/(r-o);return[i/e,0,0,0,0,i,0,0,0,0,(r+o)*n,-1,0,0,r*o*n*2,0]},orthographic:function(t,e,r,o,i,n){return[2/(e-t),0,0,0,0,2/(o-r),0,0,0,0,2/(i-n),0,(t+e)/(t-e),(r+o)/(r-o),(i+n)/(i-n),1]},projection:function(t,e,r){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/r,0,-1,1,0,1]},translation:function(t,e,r){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1]},xRotation:function(t){let e=Math.cos(t),r=Math.sin(t);return[1,0,0,0,0,e,r,0,0,-r,e,0,0,0,0,1]},yRotation:function(t){let e=Math.cos(t),r=Math.sin(t);return[e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1]},zRotation:function(t){let e=Math.cos(t),r=Math.sin(t);return[e,r,0,0,-r,e,0,0,0,0,1,0,0,0,0,1]},scaling:function(t,e,r){return[t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1]},translate:function(t,e,r,o){return s.multiply(t,s.translation(e,r,o))},xRotate:function(t,e){return s.multiply(t,s.xRotation(e))},yRotate:function(t,e){return s.multiply(t,s.yRotation(e))},zRotate:function(t,e){return s.multiply(t,s.zRotation(e))},scale:function(t,e,r,o){return s.multiply(t,s.scaling(e,r,o))}},st=`#version 300 es

  //in vec4 a_color;
  in vec4 a_position;
  in vec3 a_normal;
  uniform mat4 u_worldViewProjection;
  uniform mat4 u_world;

  // a varying the color to the fragment shader
  //out vec4 v_color;
  out vec3 v_normal;
   
  void main() {
    // Pass the color to the fragment shader.
    //v_color = a_color;
    
    gl_Position = u_worldViewProjection * a_position;

    // orient the normals and pass to the fragment shader
     v_normal = mat3(u_world) * a_normal;
  }
`,lt=`#version 300 es
 
// fragment shaders don't have a default precision so we need
// to pick one. highp is a good default. It means "high precision"
precision highp float;

// the varied color passed from the vertex shader
//in vec4 v_color;

// Passed in and varied from the vertex shader.
in vec3 v_normal;
 
uniform vec3 u_reverseLightDirection;
uniform vec4 u_color;
 
// we need to declare an output for the fragment shader
out vec4 outColor;
 
void main() {
  // outColor = v_color;

  // because v_normal is a varying it's interpolated
  // so it will not be a unit vector. Normalizing it
  // will make it a unit vector again
  vec3 normal = normalize(v_normal);
 
  // compute the light by taking the dot product
  // of the normal to the light's reverse direction
  float light = dot(normal, u_reverseLightDirection);
  
  outColor = u_color;
  outColor.rgb *= light;
  if(outColor.r < 0.1) outColor.rgb = vec3(u_color) / 4.0;
}
`;function rt(t,e,r){var o=t.createShader(e);t.shaderSource(o,r),t.compileShader(o);var i=t.getShaderParameter(o,t.COMPILE_STATUS);if(i)return o;console.log(t.getShaderInfoLog(o)),t.deleteShader(o)}function ct(t,e,r){var o=t.createProgram();t.attachShader(o,e),t.attachShader(o,r),t.linkProgram(o);var i=t.getProgramParameter(o,t.LINK_STATUS);if(i)return o}const a=class{constructor(){l(this,"positionMatrix");a.isInitCalled||a.init(),this.positionMatrix=s.yRotation(0)}static init(){a.isInitCalled=!0,a.generatePositions(),a.generateNormals(),a.drawCode="cube",a.vertexShader=rt(gl,gl.VERTEX_SHADER,st),a.fragmentShader=rt(gl,gl.FRAGMENT_SHADER,lt),a.program=ct(gl,a.vertexShader,a.fragmentShader),a.worldViewProjectionLocation=gl.getUniformLocation(a.program,"u_worldViewProjection"),a.worldLocation=gl.getUniformLocation(a.program,"u_world"),a.positionAttributeLocation=gl.getAttribLocation(a.program,"a_position"),a.colorUniformLocation=gl.getUniformLocation(a.program,"u_color"),a.reverseLightDirectionLocation=gl.getUniformLocation(a.program,"u_reverseLightDirection"),a.normalAttributeLocation=gl.getAttribLocation(a.program,"a_normal"),a.vao=gl.createVertexArray(),gl.bindVertexArray(a.vao),a.normalBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,a.normalBuffer),gl.bufferData(gl.ARRAY_BUFFER,a.normals,gl.STATIC_DRAW),gl.enableVertexAttribArray(a.normalAttributeLocation),gl.vertexAttribPointer(a.normalAttributeLocation,3,gl.FLOAT,!1,0,0),a.positionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,a.positionBuffer),gl.bufferData(gl.ARRAY_BUFFER,a.positions,gl.STATIC_DRAW),gl.enableVertexAttribArray(a.positionAttributeLocation);let e=3,r=gl.FLOAT,o=!1,i=0,n=0;gl.vertexAttribPointer(a.positionAttributeLocation,e,r,o,i,n)}draw(e,r){e!=a.drawCode&&(gl.useProgram(a.program),gl.uniform3fv(a.reverseLightDirectionLocation,s.normalize([.5,.7,1])),gl.uniformMatrix4fv(a.worldLocation,!1,s.yRotation(0)),gl.uniform4fv(a.colorUniformLocation,[.2,1,.2,1])),gl.uniformMatrix4fv(a.worldViewProjectionLocation,!1,r);let o=gl.TRIANGLES,i=0,n=36;gl.drawArrays(o,i,n)}translate(e,r,o){this.positionMatrix=s.translate(this.positionMatrix,e,r,o)}scale(e,r,o){this.positionMatrix=s.scale(this.positionMatrix,e,r,o)}static generatePositions(){a.positions=new Float32Array([1,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,1,0,0,0,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,0,1,1,1,1,1,1,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,1,1,1,1,1,1,0,0,1,0,0,1,1,1,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,1])}static generateColors(){a.colors=new Uint8Array([255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,0,0,255,0,0,255,255,255,0,0,0,255,0,0,255,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255,255,0,0,0,255,0,0,0,255])}static generateNormals(){a.normals=new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0])}};let v=a;l(v,"isInitCalled"),l(v,"drawCode"),l(v,"positions"),l(v,"normals"),l(v,"vertexShader"),l(v,"fragmentShader"),l(v,"program"),l(v,"positionAttributeLocation"),l(v,"colorUniformLocation"),l(v,"reverseLightDirectionLocation"),l(v,"normalAttributeLocation"),l(v,"worldLocation"),l(v,"worldViewProjectionLocation"),l(v,"vao"),l(v,"positionBuffer"),l(v,"normalBuffer");class ut{constructor(){l(this,"matrix");l(this,"Keyboard");l(this,"canvas");l(this,"isPointerLocked");this.matrix=s.lookAt([80,80,110],[50,0,50],[0,1,0])}translate(e,r,o){this.matrix=s.translate(this.matrix,e,r,o)}init(){this.canvas=document.querySelector("#c"),this.canvas.requestPointerLock=this.canvas.requestPointerLock||this.canvas.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,document.addEventListener("pointerlockchange",()=>this.isPointerLocked=!this.isPointerLocked,!1),this.canvas.onclick=()=>{this.isPointerLocked||this.canvas.requestPointerLock()},this.canvas.addEventListener("mousemove",e=>{log4(`mouse: ${e.clientX}:${e.clientY} mousemovementX: ${e.movementX} mousemovementY: ${e.movementY} canvas dim: ${this.canvas.width}:${this.canvas.height}`),this.isPointerLocked&&(this.matrix=s.yRotate(this.matrix,-.001*e.movementX),this.matrix=s.xRotate(this.matrix,-.001*e.movementY))},!1),this.Keyboard={keys:{},keyPress:function(e){this.keys[e.key]>0||(this.keys[e.key]=e.timeStamp||new Date().getTime(),log4(JSON.stringify(this.keys)))},keyRelease:function(e){this.keys[e.key]=0,log4(JSON.stringify(this.keys))}},window.addEventListener("keydown",this.Keyboard.keyPress.bind(this.Keyboard)),window.addEventListener("keyup",this.Keyboard.keyRelease.bind(this.Keyboard))}update(){this.Keyboard.keys.w>0&&this.translate(0,0,-1.1),this.Keyboard.keys.s>0&&this.translate(0,0,1.1),this.Keyboard.keys.a>0&&this.translate(-1.1,0,0),this.Keyboard.keys.d>0&&this.translate(1.1,0,0),this.Keyboard.keys.escape>0&&document.exitPointerLock()}}let mt=0,X,K=[],ot,vt=document.querySelector("#fps"),V=100,N,G=0;function dt(){var t=document.querySelector("#c");if(globalThis.gl=t.getContext("webgl2"),!gl){alert("error: no webgl capability");return}J(),X=new ut,X.init(),it()}function J(){let t=[],e=0;for(let r=0;r<N.data.length;r+=4)t[e]=(.2126*N.data[r+0]+.7152*N.data[r+1]+.0722*N.data[r+2])/10,e++;K=[];for(let r=0;r<V;r++)for(let o=0;o<V;o++){let i=new v;i.scale(1,t[V*o+r],1),i.translate(r*1,0,o*1),K.push(i)}}function it(){let t=Date.now();gl.enable(gl.CULL_FACE),gl.enable(gl.DEPTH_TEST),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),ft(gl.canvas),gl.viewport(0,0,gl.canvas.width,gl.canvas.height);var e=gl.canvas.clientWidth/gl.canvas.clientHeight,r=.1,o=500,i=s.perspective(s.degToRad(75),e,r,o),n=s.inverse(X.matrix),c=s.multiply(i,n);for(let u=0;u<V;u++)for(let m=0;m<V;m++){let d=s.multiply(c,K[V*m+u].positionMatrix);K[V*m+u].draw(ot,d),ot=K[V*m+u].constructor.drawCode}X.update(),G>1e3?(vt.textContent=`FPS: ${1e3/(Date.now()-t)}`,G=0):G+=Date.now()-t,window.requestAnimationFrame(it)}function ft(t){const e=t.clientWidth,r=t.clientHeight,o=t.width!==e||t.height!==r;return o&&(t.width=e,t.height=r),o}function gt(){[1,2,3,4,5].forEach(e=>{globalThis["log"+e]=function(r){mt>=e&&console.log(r)}})}function ht(){let t=document.querySelectorAll(".image"),e=0;return function(r){if(r?e++:e--,e<0){e=0;return}if(e>=t.length){e=t.length-1;return}let o=document.querySelector("#imgc");log5(o.width+" "+o.height);let i=o.getContext("2d",{willReadFrequently:!0});i.clearRect(0,0,o.width,o.height),i.drawImage(t[e],0,0,100,100),N=i.getImageData(0,0,o.width,o.height),log5(N)}}function pt(t){document.querySelector("#nextImage").addEventListener("click",()=>{t(!0),J()}),document.querySelector("#prevImage").addEventListener("click",()=>{t(!1),J()})}window.addEventListener("load",t=>{gt();const e=ht();e(!0),pt(e),dt()});
